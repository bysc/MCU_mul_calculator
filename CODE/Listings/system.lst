C51 COMPILER V9.54   SYSTEM                                                                12/04/2023 22:25:51 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE SYSTEM
OBJECT MODULE PLACED IN .\Objects\system.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE system.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\sy
                    -stem.lst) TABS(2) OBJECT(.\Objects\system.obj)

line level    source

   1          /*简单说明lcd显示流程：
   2          计算器：dc---->字符串--->提示字符串---->字符串
   3                  =---->字符串---->结果
   4          进制转换器：dc--->仅处理字符串，不显示字符串，显示提示符--->紧接着计算十六进制代码并刷新显示*/
   5          #include "system.h"
   6          void welcome()
   7          {
   8   1        lcd_init();
   9   1        lcd_printstr("Welcome!");
  10   1        lcd_gotoxy(1,0);
  11   1        lcd_printstr("bysc");
  12   1        lcd_delay(1000);
  13   1        lcd_writecmd(0x01);
  14   1      }
  15          void clearStr(unsigned char *str,unsigned char len)
  16          {
  17   1        unsigned char i;
  18   1        for(i=0;i<len;i++) str[i]='\0';
  19   1      }
  20          void addStr(unsigned char *str,unsigned char *index,unsigned char press)
  21          {
  22   1        if(*index==15) 
  23   1        {
  24   2          lcd_init();
  25   2          lcd_printstr("space overflower");
  26   2          lcd_delay(1000);
  27   2          lcd_writecmd(0x01);
  28   2          lcd_printstr(str);
  29   2        }
  30   1        else
  31   1        {
  32   2          (*index)++;
  33   2          str[*index]=press;
  34   2          lcd_writedata(press);
  35   2        }
  36   1      }
  37          void delStr(unsigned char *str,unsigned char *index)
  38          {
  39   1        if((*index)==-1)
  40   1        {
  41   2          lcd_init();
  42   2          lcd_printstr("space null");
  43   2          lcd_delay(1000);
  44   2        }
  45   1        else
  46   1        {
  47   2          str[*index]=0;
  48   2          (*index)--;
  49   2        }
  50   1        lcd_writecmd(0x01);
  51   1        lcd_printstr(str);
  52   1      }
  53          void getAnswer(unsigned char *str,unsigned char *index)
  54          {
C51 COMPILER V9.54   SYSTEM                                                                12/04/2023 22:25:51 PAGE 2   

  55   1        float x1=0,x2=0,y=0;
  56   1        bit point1=0,operation=0,point2=0;
  57   1        unsigned char action=0;
  58   1        unsigned char i;
  59   1        float power=1;//浮点加权
  60   1        
  61   1        if((*index)==-1)
  62   1        {
  63   2            lcd_printstr("nothing to print");
  64   2            lcd_delay(1000);
  65   2            lcd_writecmd(0x01);
  66   2            return;     
  67   2        }
  68   1        for(i=0;i<=(*index);i++)
  69   1        {
  70   2          if(str[i]=='+'||str[i]=='-'||str[i]=='*'||str[i]=='/') 
  71   2          {
  72   3            action=str[i];
  73   3            operation=1;
  74   3          }
  75   2          else if(str[i]=='.')//条件运算符不能做左值？
  76   2          {
  77   3            if(operation==1) point2=1;
  78   3            else point1=1;    
  79   3            power=1;
  80   3          }
  81   2          else if(point1==0 && operation==0) x1=x1*10+str[i]-'0';
  82   2          else if(point1==1 && operation==0) 
  83   2          {
  84   3            power*=0.1;
  85   3            x1+=(str[i]-'0')*power; 
  86   3          }
  87   2          //程序跑到这里运算符必定加载
  88   2          else if(point2==0) x2=x2*10+str[i]-'0';
  89   2          else if(point2==1) 
  90   2          {
  91   3            power*=0.1;
  92   3            x2+=(str[i]-'0')*power;
  93   3          }
  94   2          else 
  95   2          {
  96   3            x1=0;
  97   3            x2=0;
  98   3            lcd_gotoxy(1,0);
  99   3            lcd_printstr("unexp error");
 100   3            lcd_delay(1000);
 101   3          }
 102   2        }
 103   1        switch(action)
 104   1        {
 105   2          case '+': y=x1+x2;break;
 106   2          case '-': y=x1-x2;break;
 107   2          case '*': y=x1*x2;break;
 108   2          case '/': y=x1/x2;break;//x2=0,y=+INF
 109   2          default: y=x1;break;
 110   2        }
 111   1          clearStr(str,17);
 112   1          sprintf(str,"%.6f",y);
 113   1          lcd_gotoxy(1,0);
 114   1          lcd_printstr(str);
 115   1          (*index)=-1;
 116   1          point1=0;
C51 COMPILER V9.54   SYSTEM                                                                12/04/2023 22:25:51 PAGE 3   

 117   1          point2=0;
 118   1          operation=0;
 119   1          action=0;
 120   1      }
 121          void calculator(unsigned char *str,unsigned char *index,unsigned char press)
 122          {
 123   1          if(end_mark)
 124   1          {
 125   2            lcd_writecmd(0x01);
 126   2            end_mark=0;
 127   2          }
 128   1          else if(press=='=') 
 129   1          {
 130   2            getAnswer(str,index);
 131   2            end_mark=1;//结束后按任意键结束运算并初始化
 132   2          }
 133   1          else if(press=='d') delStr(str,index);
 134   1          else if(press=='c') 
 135   1          {
 136   2            lcd_writecmd(0x01);
 137   2            clearStr(str,17);
 138   2            (*index)=-1;
 139   2          }
 140   1          else addStr(str,index,press);
 141   1      }
 142          bh_delStr(unsigned char *str,unsigned char *index)
 143          {
 144   1        if((*index)==-1)
 145   1        {
 146   2          lcd_init();
 147   2          lcd_printstr("space null");
 148   2          lcd_delay(1000);
 149   2        }
 150   1        else
 151   1        {
 152   2          str[*index]=0;//区分字符0和数字0
 153   2          (*index)--;
 154   2        } 
 155   1      }
 156          //二进制到十六进制动态显示
 157          void binToHEX(unsigned char *str,unsigned char *index,unsigned char press)
 158          {
 159   1        unsigned int BI=0x0000;//用于存储16位二进制数
 160   1        unsigned char HE[6]={0};//用于存储4位十六进制数，后缀H
 161   1        char i,j,tmp;
 162   1        if(press=='d') bh_delStr(str,index);//仅删除，不做其他操作
 163   1        else if(press=='c')
 164   1        {
 165   2          lcd_writecmd(0x01);
 166   2          clearStr(str,17);
 167   2          (*index)=-1;
 168   2          return;
 169   2        }
 170   1        else if(press!='0'&&press!='1')
 171   1        {
 172   2          lcd_writecmd(0x01);
 173   2          lcd_printstr("invalid input");
 174   2          lcd_delay(500);
 175   2        }
 176   1        
 177   1        //add str
 178   1        else 
C51 COMPILER V9.54   SYSTEM                                                                12/04/2023 22:25:51 PAGE 4   

 179   1        {
 180   2          if(*index==15) 
 181   2          {
 182   3            lcd_writecmd(0x01);
 183   3            lcd_printstr("space overflower");
 184   3            lcd_delay(1000);
 185   3          }
 186   2          else
 187   2          {
 188   3            (*index)++;
 189   3            str[*index]=press;
 190   3          }
 191   2        }
 192   1      /*=============================================
 193   1        =============不理解=========================
 194   1        =========为什么index=-1就会死机================*/
 195   1        if(*index==-1)
 196   1        {
 197   2          lcd_writecmd(0x01);
 198   2          return;
 199   2        }
 200   1        /*===========================================*/
 201   1        for(i=0;i<=(*index);i++)
 202   1        {
 203   2          BI=(BI<<1)+str[i]-'0';
 204   2        }//BI更新
 205   1          //16->4拆分计算
 206   1      /* 
 207   1      ----<-------------------<-------------------------<---------press左移放入BI
 208   1        ___________ tmp_____________tmp_________tmp________tmp__
 209   1        BI|15 14  13  12||||11  10  9 8||||7  6 5 4||||3  2 1 0|||
 210   1          --------------||||-----------||||--------||||--------|||
 211   1        i |     HE[0]   ||||    HE[1]  ||||   HE[2]||||  HE[3] |||
 212   1          --------------||||-----------||||--------||||--------|||
 213   1          */
 214   1        for(i=0;i<4;i++)
 215   1        {
 216   2          tmp=(3-i)*4;//tmp指向
 217   2          for(j=tmp;j<tmp+4;j++)
 218   2          {
 219   3            HE[i]+=((BI>>j)&1)<<(j-tmp);
 220   3          }
 221   2          if(HE[i]>=0&&HE[i]<=9) HE[i]+='0';
 222   2          else if(HE[i]>=10) HE[i]=HE[i]-10+'A';
 223   2          HE[4]='H';
 224   2        }
 225   1        lcd_writecmd(0x01);
 226   1        lcd_printstr(str);
 227   1        lcd_gotoxy(1,0);
 228   1        lcd_printstr(HE);
 229   1      }
*** WARNING C290 IN LINE 155 OF system.c: missing return value


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1664    ----
   CONSTANT SIZE    =     96    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      69
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       3
C51 COMPILER V9.54   SYSTEM                                                                12/04/2023 22:25:51 PAGE 5   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
