C51 COMPILER V9.54   SYSTEM                                                                11/25/2023 00:31:51 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE SYSTEM
OBJECT MODULE PLACED IN .\Objects\system.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE system.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\sy
                    -stem.lst) TABS(2) OBJECT(.\Objects\system.obj)

line level    source

   1          #include "system.h"
   2          void welcome()
   3          {
   4   1        lcd_init();
   5   1        lcd_printstr("Welcome!");
   6   1        lcd_gotoxy(1,0);
   7   1        lcd_printstr("bysc");
   8   1        lcd_delay(500);
   9   1        lcd_writecmd(0x01);
  10   1      }
  11          void clearStr(unsigned char *str,unsigned char len)
  12          {
  13   1        unsigned char i;
  14   1        for(i=0;i<len;i++) str[i]='\0';
  15   1      }
  16          void addStr(unsigned char *str,unsigned char *index,unsigned char press)
  17          {
  18   1        if(*index==15) 
  19   1        {
  20   2          lcd_init();
  21   2          lcd_printstr("space overflower");
  22   2          lcd_delay(1000);
  23   2          lcd_init();
  24   2          lcd_printstr(str);
  25   2        }
  26   1        else
  27   1        {
  28   2          (*index)++;
  29   2          str[*index]=press;
  30   2          lcd_writedata(press);
  31   2        }
  32   1      }
  33          void delStr(unsigned char *str,unsigned char *index)
  34          {
  35   1        if((*index)==-1)
  36   1        {
  37   2          lcd_init();
  38   2          lcd_printstr("space null");
  39   2          lcd_delay(1000);
  40   2        }
  41   1        else
  42   1        {
  43   2          str[*index]=0;
  44   2          (*index)--;
  45   2        }
  46   1        lcd_init();
  47   1        lcd_printstr(str);
  48   1      }
  49          void getAnswer(unsigned char *str,unsigned char *index)
  50          {
  51   1        float x1=0,x2=0,y=0;
  52   1        bit point1=0,operation=0,point2=0;
  53   1        unsigned char action=0;
  54   1        unsigned char i;
C51 COMPILER V9.54   SYSTEM                                                                11/25/2023 00:31:51 PAGE 2   

  55   1        float power=1;//浮点加权
  56   1        
  57   1        if((*index)==-1)
  58   1        {
  59   2            lcd_printstr("nothing to print");
  60   2            lcd_delay(1000);
  61   2            lcd_init();
  62   2            return;     
  63   2        }
  64   1        for(i=0;i<=(*index);i++)
  65   1        {
  66   2          if(str[i]=='+'||str[i]=='-'||str[i]=='*'||str[i]=='/') 
  67   2          {
  68   3            action=str[i];
  69   3            operation=1;
  70   3          }
  71   2          else if(str[i]=='.')//条件运算符不能做左值？
  72   2          {
  73   3            if(operation==1) point2=1;
  74   3            else point1=1;    
  75   3            power=1;
  76   3          }
  77   2          else if(point1==0 && operation==0) x1=x1*10+str[i]-'0';
  78   2          else if(point1==1 && operation==0) 
  79   2          {
  80   3            power*=0.1;
  81   3            x1+=(str[i]-'0')*power; 
  82   3          }
  83   2          //程序跑到这里运算符必定加载
  84   2          else if(point2==0) x2=x2*10+str[i]-'0';
  85   2          else if(point2==1) 
  86   2          {
  87   3            power*=0.1;
  88   3            x2+=(str[i]-'0')*power;
  89   3          }
  90   2          else 
  91   2          {
  92   3            x1=0;
  93   3            x2=0;
  94   3            lcd_gotoxy(1,0);
  95   3            lcd_printstr("unexp error");
  96   3            lcd_delay(1000);
  97   3          }
  98   2        }
  99   1        switch(action)
 100   1        {
 101   2          case '+': y=x1+x2;break;
 102   2          case '-': y=x1-x2;break;
 103   2          case '*': y=x1*x2;break;
 104   2          case '/': y=x1/x2;break;//x2=0,y=+INF
 105   2          default: y=x1;break;
 106   2        }
 107   1          clearStr(str,17);
 108   1          sprintf(str,"%.6f",y);
 109   1          lcd_gotoxy(1,0);
 110   1          lcd_printstr(str);
 111   1          (*index)=-1;
 112   1          point1=0;
 113   1          point2=0;
 114   1          operation=0;
 115   1          action=0;
 116   1      }
C51 COMPILER V9.54   SYSTEM                                                                11/25/2023 00:31:51 PAGE 3   

 117          void calculator(unsigned char *str,unsigned char *index,unsigned char press)
 118          {
 119   1          if(end_mark)
 120   1          {
 121   2            lcd_init();
 122   2            end_mark=0;
 123   2          }
 124   1          else if(press=='=') 
 125   1          {
 126   2            getAnswer(str,index);
 127   2            end_mark=1;//结束后按任意键结束运算并初始化
 128   2          }
 129   1          else if(press=='d') delStr(str,index);
 130   1          else if(press=='c') 
 131   1          {
 132   2            lcd_init();
 133   2            clearStr(str,17);
 134   2            (*index)=-1;
 135   2          }
 136   1          else addStr(str,index,press);
 137   1      }
 138          bh_delStr(unsigned char *str,unsigned char *index)
 139          {
 140   1        if((*index)==-1)
 141   1        {
 142   2          lcd_init();
 143   2          lcd_printstr("space null");
 144   2          lcd_delay(1000);
 145   2        }
 146   1        else
 147   1        {
 148   2          str[*index]=0;//区分字符0和数字0
 149   2          (*index)--;
 150   2        } 
 151   1      }
 152          //二进制到十六进制动态显示
 153          void binToHEX(unsigned char *str,unsigned char *index,unsigned char press)
 154          {
 155   1        unsigned int BI=0x0000;//用于存储16位二进制数
 156   1        unsigned char HE[6]={0};//用于存储4位十六进制数，后缀H
 157   1        unsigned char i,j,tmp;
 158   1        if(press=='d') bh_delStr(str,index);//仅删除，不做其他操作
 159   1        else if(press=='c')
 160   1        {
 161   2          lcd_init();
 162   2          clearStr(str,17);
 163   2          (*index)=-1;
 164   2          return;
 165   2        }
 166   1        else if(press!='0'&&press!='1')
 167   1        {
 168   2          lcd_init();
 169   2          lcd_printstr("invalid input");
 170   2          lcd_delay(500);
 171   2        }
 172   1        
 173   1        //add str
 174   1        else 
 175   1        {
 176   2          if(*index==15) 
 177   2          {
 178   3            lcd_init();
C51 COMPILER V9.54   SYSTEM                                                                11/25/2023 00:31:51 PAGE 4   

 179   3            lcd_printstr("space overflower");
 180   3            lcd_delay(1000);
 181   3          }
 182   2          else
 183   2          {
 184   3            (*index)++;
 185   3            str[*index]=press;
 186   3          }
 187   2        }
 188   1        for(i=0;i<=(*index);i++)
 189   1        {
 190   2          BI=(BI<<1)+str[i]-'0';
 191   2        }//BI更新
 192   1          //16->4拆分计算
 193   1      /*  ___________ tmp_____________tmp_________tmp________tmp__
 194   1        BI|15 14  13  12||||11  10  9 8||||7  6 5 4||||3  2 1 0|||
 195   1          --------------||||-----------||||--------||||--------|||
 196   1        i |     HE[0]   ||||    HE[1]  ||||   HE[2]||||  HE[3] |||
 197   1          --------------||||-----------||||--------||||--------|||
 198   1          */
 199   1        for(i=0;i<4;i++)
 200   1        {
 201   2          tmp=(3-i)*4;//tmp指向
 202   2          for(j=tmp;j<tmp+4;j++)
 203   2          {
 204   3            HE[i]+=((BI>>j)&1)<<(j-tmp);
 205   3          }
 206   2          if(HE[i]>=0&&HE[i]<=9) HE[i]+='0';
 207   2          else if(HE[i]>=10) HE[i]=HE[i]-10+'A';
 208   2          HE[4]='H';
 209   2        }
 210   1        lcd_init();
 211   1        lcd_printstr(str);
 212   1        lcd_gotoxy(1,0);
 213   1        lcd_printstr(HE);
 214   1      }
*** WARNING C290 IN LINE 151 OF system.c: missing return value


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1597    ----
   CONSTANT SIZE    =     96    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      69
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       3
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
